<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçΩÔ∏è –ë–ñ–£ PRO v5.2 ‚Äî –£–º–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä —Ä–∞—Ü–∏–æ–Ω–æ–≤</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif; 
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            color: white; min-height: 100vh; padding: 20px;
        }
        .container { max-width: 1500px; margin: 0 auto; }
        
        .header { 
            text-align: center; padding: 50px 30px; 
            background: rgba(255,255,255,0.08); border-radius: 30px; 
            backdrop-filter: blur(20px); margin-bottom: 40px; border: 1px solid rgba(255,255,255,0.1);
        }
        .header h1 { font-size: clamp(2.5em, 6vw, 4em); margin-bottom: 15px; background: linear-gradient(45deg, #10b981, #34d399); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .header p { font-size: 1.4em; opacity: 0.9; margin-bottom: 20px; }
        
        .tabs { 
            display: flex; justify-content: center; gap: 15px; 
            margin-bottom: 40px; flex-wrap: wrap;
        }
        .tab-btn { 
            background: rgba(255,255,255,0.1); color: white; 
            padding: 18px 40px; border: 2px solid rgba(255,255,255,0.2); border-radius: 50px; 
            cursor: pointer; font-weight: 700; font-size: 16px; 
            transition: all 0.4s; backdrop-filter: blur(20px);
        }
        .tab-btn:hover { background: rgba(255,255,255,0.2); transform: translateY(-3px); border-color: rgba(16,185,129,0.5); }
        .tab-btn.active { 
            background: linear-gradient(45deg, #10b981, #059669); 
            box-shadow: 0 15px 40px rgba(16,185,129,0.3); border-color: #10b981;
        }
        
        .tab-content { display: none; animation: slideIn 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        .tab-content.active { display: block; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(40px); } to { opacity: 1; transform: translateY(0); } }
        
        .grid { display: grid; grid-template-columns: 1fr 420px; gap: 35px; }
        @media (max-width: 1300px) { .grid { grid-template-columns: 1fr; } }
        
        .card { 
            background: rgba(255,255,255,0.12); padding: 35px; 
            border-radius: 25px; backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 30px; color: #f1f5f9;
        }
        .card h3 { color: white; margin-bottom: 25px; font-size: 1.4em; }
        
        .controls-row { display: flex; flex-wrap: wrap; gap: 25px; align-items: end; margin-bottom: 30px; }
        .control-group { display: flex; flex-direction: column; gap: 10px; min-width: 150px; }
        input, select { 
            padding: 18px 20px; border: 2px solid rgba(255,255,255,0.2); border-radius: 18px; 
            font-size: 16px; font-weight: 500; background: rgba(255,255,255,0.1);
            color: white; backdrop-filter: blur(10px); transition: all 0.3s;
        }
        input::placeholder { color: rgba(255,255,255,0.6); }
        input:focus, select:focus { outline: none; border-color: #10b981; box-shadow: 0 0 0 4px rgba(16,185,129,0.2); }
        label { font-weight: 700; color: #e2e8f0; font-size: 14px; }
        
        .btn { 
            background: linear-gradient(45deg, #10b981, #059669); color: white; 
            padding: 18px 40px; border: none; border-radius: 18px; cursor: pointer; 
            font-size: 16px; font-weight: 700; box-shadow: 0 10px 30px rgba(16,185,129,0.3);
            transition: all 0.3s; border: 2px solid transparent;
        }
        .btn:hover { transform: translateY(-4px); box-shadow: 0 20px 40px rgba(16,185,129,0.4); }
        .btn-secondary { background: linear-gradient(45deg, #3b82f6, #1d4ed8); box-shadow: 0 10px 30px rgba(59,130,246,0.3); }
        .btn-large { font-size: 18px; padding: 22px 50px; }
        
        table { width: 100%; border-collapse: collapse; color: #e2e8f0; font-size: 15px; }
        th, td { padding: 20px 18px; text-align: left; }
        th { background: rgba(16,185,129,0.2); font-weight: 700; font-size: 14px; border-radius: 12px 12px 0 0; }
        tr { background: rgba(255,255,255,0.05); border-radius: 15px; margin-bottom: 10px; }
        tr:hover { background: rgba(16,185,129,0.1); transform: translateY(-2px); transition: all 0.3s; }
        
        .protein { color: #10b981; font-weight: bold; }
        .carbs { color: #3b82f6; font-weight: bold; }
        .fat-low { color: #059669; }
        .fat-high { color: #f59e0b; }
        .score-badge { 
            background: linear-gradient(45deg, #10b981, #059669); 
            color: white; padding: 8px 16px; border-radius: 25px; font-size: 13px; font-weight: bold;
            box-shadow: 0 4px 15px rgba(16,185,129,0.3);
        }
        
        .chart-container { 
            height: 450px; width: 100%; 
            background: rgba(255,255,255,0.1); border-radius: 25px; 
            padding: 30px; backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1);
        }
        
        .loading { text-align: center; padding: 100px 50px; color: #94a3b8; font-size: 22px; }
        .error { background: rgba(239,68,68,0.2); color: #fca5a5; padding: 50px; border-radius: 20px; text-align: center; border: 1px solid rgba(239,68,68,0.3); }
        
        .totals-card { 
            background: linear-gradient(135deg, #10b981, #059669, #047857); 
            color: white; padding: 40px; border-radius: 25px; text-align: center;
            box-shadow: 0 25px 60px rgba(16,185,129,0.4); border: none;
        }
        .quality-badge { 
            font-size: 2.5em; font-weight: bold; margin: 20px 0;
            background: linear-gradient(45deg, #fef3c7, #fde68a); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .nutrient-badge { 
            display: inline-block; padding: 12px 24px; margin: 10px; 
            border-radius: 30px; font-weight: 700; font-size: 16px; box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        .prot-badge { background: rgba(16,185,129,0.3); border: 2px solid #10b981; }
        .fat-badge { background: rgba(245,158,11,0.3); border: 2px solid #f59e0b; }
        .carb-badge { background: rgba(59,130,246,0.3); border: 2px solid #3b82f6; }
        
        .quality-breakdown { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 30px; }
        .breakdown-item { background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; text-align: center; }
        
        @media (max-width: 768px) {
            .controls-row { flex-direction: column; align-items: stretch; gap: 20px; }
            input, select, .btn { width: 100%; margin-bottom: 0; }
            .tabs { flex-direction: column; align-items: center; gap: 15px; }
            .header h1 { font-size: 2.5em; }
            .grid { gap: 20px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçΩÔ∏è –ë–ñ–£ <span>PRO</span> v5.2</h1>
            <p>üîç –£–º–Ω—ã–π –ø–æ–¥–±–æ—Ä ‚Ä¢ üìä –ì—Ä–∞—Ñ–∏–∫–∏ ‚Ä¢ üçΩÔ∏è –ò–¥–µ–∞–ª—å–Ω—ã–µ —Ä–∞—Ü–∏–æ–Ω—ã ‚Ä¢ üß† –ê–Ω–∞–ª–∏–∑ –∫–∞—á–µ—Å—Ç–≤–∞</p>
            
            <div class="tabs">
                <button class="tab-btn active" onclick="showTab('recommend')">üîç –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</button>
                <button class="tab-btn" onclick="showTab('plan')">üçΩÔ∏è –î–Ω–µ–≤–Ω–æ–π —Ä–∞—Ü–∏–æ–Ω</button>
                <button class="tab-btn" onclick="showTab('stats')">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
            </div>
        </div>

        <!-- üîç –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò v5.2 -->
        <div id="recommend" class="tab-content active">
            <div class="grid">
                <div>
                    <div class="card">
                        <h3>üîç –§–∏–ª—å—Ç—Ä—ã –ë–ñ–£</h3>
                        <div class="controls-row">
                            <div class="control-group">
                                <label>üîç –ü–æ–∏—Å–∫</label>
                                <input id="search" placeholder="–∫—É—Ä–∏—Ü–∞, —Ä—ã–±–∞, —Ç–≤–æ—Ä–æ–≥...">
                            </div>
                            <div class="control-group">
                                <label>–ö–∫–∞–ª ‚â§</label>
                                <input id="max_cal" type="number" value="600">
                            </div>
                            <div class="control-group">
                                <label>–ë–µ–ª–æ–∫ ‚â•</label>
                                <input id="min_prot" type="number" value="20">
                            </div>
                            <div class="control-group">
                                <label>–ñ–∏—Ä—ã ‚â§</label>
                                <input id="max_fat" type="number" value="20">
                            </div>
                            <div class="control-group">
                                <label>–£–≥–ª–µ–≤–æ–¥—ã ‚â•</label>
                                <input id="min_carbs" type="number" value="0">
                            </div>
                        </div>
                        <div style="display: flex; gap: 20px; flex-wrap: wrap; align-items: center;">
                            <div class="control-group" style="min-width: 160px;">
                                <label>–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ</label>
                                <select id="sort">
                                    <option value="score">‚≠ê –ë–ñ–£ Score</option>
                                    <option value="protein">üí™ –ë–µ–ª–æ–∫</option>
                                    <option value="fat">üßà –ñ–∏—Ä—ã</option>
                                    <option value="carbs">üçö –£–≥–ª–µ–≤–æ–¥—ã</option>
                                    <option value="rating">‚≠ê –†–µ–π—Ç–∏–Ω–≥</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label>–ü–æ—Ä—è–¥–æ–∫</label>
                                <select id="order">
                                    <option value="desc">–ü–æ —É–±—ã–≤–∞–Ω–∏—é</option>
                                    <option value="asc">–ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label>–ü–æ–∫–∞–∑–∞—Ç—å</label>
                                <select id="limit">
                                    <option value="10">10</option>
                                    <option value="20">20</option>
                                    <option value="50">50</option>
                                </select>
                            </div>
                            <button class="btn" onclick="loadRecommend()">üîç –ù–∞–π—Ç–∏ –±–ª—é–¥–∞</button>
                            <button class="btn btn-secondary" onclick="presetProtein()">üí™ –¢–æ–ª—å–∫–æ –ø—Ä–æ—Ç–µ–∏–Ω</button>
                            <button class="btn btn-secondary" onclick="presetDiet()">ü•ó –î–∏–µ—Ç–∞</button>
                        </div>
                    </div>
                    
                    <div id="recommend-results" class="loading">üîÑ –ó–∞–¥–∞–π—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏ –Ω–∞–∂–º–∏—Ç–µ "–ù–∞–π—Ç–∏ –±–ª—é–¥–∞"</div>
                </div>
                
                <div>
                    <div class="card">
                        <h3>üìä –¢–æ–ø –ë–ñ–£ Score</h3>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 25px;">
                            <button class="btn" onclick="loadChart(5)" style="padding: 12px 20px; font-size: 14px;">üîÑ –¢–æ–ø-5</button>
                            <button class="btn" onclick="loadChart(10)" style="padding: 12px 20px; font-size: 14px;">üîÑ –¢–æ–ø-10</button>
                        </div>
                        <div class="chart-container">
                            <canvas id="chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- üçΩÔ∏è –î–ù–ï–í–ù–û–ô –†–ê–¶–ò–û–ù v5.2 -->
        <div id="plan" class="tab-content">
            <div class="card" style="max-width: 900px; margin: 0 auto 40px;">
                <h3 style="text-align: center;">üçΩÔ∏è –¶–µ–ª–∏ –Ω–∞ –¥–µ–Ω—å</h3>
                <div class="controls-row">
                    <div class="control-group">
                        <label>–ö–∞–ª–æ—Ä–∏–∏</label>
                        <input id="plan_cal" type="number" value="2000">
                    </div>
                    <div class="control-group">
                        <label>–ë–µ–ª–æ–∫ (–≥)</label>
                        <input id="plan_prot" type="number" value="150">
                    </div>
                    <div class="control-group">
                        <label>–ñ–∏—Ä—ã (–≥)</label>
                        <input id="plan_fat" type="number" value="70">
                    </div>
                    <div class="control-group">
                        <label>–£–≥–ª–µ–≤–æ–¥—ã (–≥)</label>
                        <input id="plan_carbs" type="number" value="250">
                    </div>
                </div>
                <div style="text-align: center; margin-top: 30px;">
                    <div class="control-group" style="display: inline-block; margin-right: 20px;">
                        <label>–ü—Ä–∏–µ–º—ã –ø–∏—â–∏</label>
                        <select id="plan_meals" style="width: 140px;">
                            <option value="3">3 (–ö–ª–∞—Å—Å–∏–∫–∞)</option>
                            <option value="4" selected>4 (+–ø–µ—Ä–µ–∫—É—Å)</option>
                            <option value="5">5 (+2 –ø–µ—Ä–µ–∫—É—Å–∞)</option>
                            <option value="6">6 (–ü–æ–ª–Ω—ã–π –¥–µ–Ω—å)</option>
                        </select>
                    </div>
                    <button class="btn btn-large" onclick="loadPlan()">üçΩÔ∏è –°–æ—Å—Ç–∞–≤–∏—Ç—å –∏–¥–µ–∞–ª—å–Ω—ã–π —Ä–∞—Ü–∏–æ–Ω</button>
                </div>
            </div>
            <div id="plan-results" class="loading">üìù –£–∫–∞–∂–∏—Ç–µ –ë–ñ–£ —Ü–µ–ª–∏ –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É</div>
        </div>

        <!-- üìà –°–¢–ê–¢–ò–°–¢–ò–ö–ê v5.2 -->
        <div id="stats" class="tab-content">
            <div style="text-align: center; margin-bottom: 40px;">
                <button class="btn btn-large" onclick="loadStats()">üìà –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</button>
            </div>
            <div id="stats-results" class="loading">üîÑ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –≤–∞—à—É –±–∞–∑—É –±–ª—é–¥...</div>
        </div>
    </div>

    <script>
        let chartInstance = null;

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // üìä –ò–ù–¢–ï–†–ê–ö–¢–ò–í–ù–´–ô –ì–†–ê–§–ò–ö
        async function loadChart(topN = 5) {
            try {
                const res = await fetch(`/chart?top_n=${topN}`);
                const data = await res.json();
                
                if (chartInstance) chartInstance.destroy();
                
                const ctx = document.getElementById('chart').getContext('2d');
                chartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: data.dishes.map(d => d.title.length > 18 ? d.title.slice(0, 15) + '...' : d.title),
                        datasets: [{
                            label: '–ë–ñ–£ Score',
                            data: data.dishes.map(d => parseFloat(d.score)),
                            backgroundColor: data.dishes.map((_, i) => 
                                `hsl(${120 + i * 25}, 75%, ${55 + i * 3}%)`
                            ),
                            borderColor: 'rgba(255,255,255,0.8)',
                            borderWidth: 2,
                            borderRadius: 15,
                            borderSkipped: false,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        animation: { duration: 1500, easing: 'easeOutQuart' },
                        scales: { 
                            y: { 
                                beginAtZero: true, 
                                max: data.max_score * 1.15,
                                ticks: { color: '#e2e8f0', font: { size: 13 } },
                                grid: { color: 'rgba(255,255,255,0.1)' }
                            },
                            x: { ticks: { color: '#cbd5e1', maxRotation: 45, font: { size: 12 } } }
                        },
                        plugins: { 
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: 'rgba(17,24,39,0.95)',
                                titleColor: 'white',
                                bodyColor: 'white',
                                borderColor: '#10b981',
                                borderWidth: 1,
                                callbacks: {
                                    label: function(ctx) {
                                        const d = data.dishes[ctx.dataIndex];
                                        return [
                                            `‚≠ê Score: ${d.score}`,
                                            `üí™ –ë: ${d.protein}–≥ | üßà –ñ: ${d.fat}–≥ | üçö –£: ${d.carbs}–≥`,
                                            `üî• ${d.calories} –∫–∫–∞–ª`
                                        ];
                                    }
                                }
                            }
                        }
                    }
                });
            } catch(e) {
                console.error('–ì—Ä–∞—Ñ–∏–∫:', e);
            }
        }

        // üîç –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò
        async function loadRecommend() {
            const params = new URLSearchParams({
                max_cal: document.getElementById('max_cal').value,
                min_prot: document.getElementById('min_prot').value,
                max_fat: document.getElementById('max_fat').value,
                min_carbs: document.getElementById('min_carbs').value,
                search: document.getElementById('search').value,
                sort: document.getElementById('sort').value,
                order: document.getElementById('order').value,
                limit: document.getElementById('limit').value
            });
            
            document.getElementById('recommend-results').innerHTML = '<div class="loading">üîç –ò—â–µ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –ë–ñ–£ –±–ª—é–¥–∞...</div>';
            
            try {
                const res = await fetch('/recommend?' + params);
                const data = await res.json();
                
                if (!data.dishes || !data.dishes.length) {
                    document.getElementById('recommend-results').innerHTML = '<div class="error">‚ùå –ë–ª—é–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –ø–æ –∑–∞–¥–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º</div>';
                    return;
                }
                
                let html = `
                    <div style="margin-bottom: 25px; padding: 20px; background: rgba(16,185,129,0.2); border-radius: 15px; border-left: 4px solid #10b981;">
                        <strong style="color: #10b981; font-size: 1.3em;">üçΩÔ∏è –ù–∞–π–¥–µ–Ω–æ ${data.count} –±–ª—é–¥</strong><br>
                        <small style="color: #cbd5e1;">
                            –ü—Ä–æ—Ç–µ–∏–Ω: <strong>${data.stats.protein_avg}–≥</strong> | 
                            –ñ–∏—Ä—ã: <strong>${data.stats.fat_avg}–≥</strong> | 
                            –£–≥–ª–µ–≤–æ–¥—ã: <strong>${data.stats.carbs_avg}–≥</strong> | 
                            Score: <strong>${data.stats.score_avg}</strong>
                        </small>
                    </div>
                    <table>
                        <tr>
                            <th style="width: 40%;">–ë–ª—é–¥–æ</th>
                            <th>–ö–∫–∞–ª</th>
                            <th>–ë</th>
                            <th>–ñ</th>
                            <th>–£</th>
                            <th>‚≠ê</th>
                            <th>Score</th>
                        </tr>`;
                
                data.dishes.forEach(d => {
                    const fatClass = parseFloat(d.fat) < 10 ? 'fat-low' : 'fat-high';
                    html += `<tr>
                        <td style="font-weight: 700; max-width: 250px;">${d.title}</td>
                        <td style="font-weight: 600;">${parseFloat(d.calories).toFixed(0)}</td>
                        <td class="protein">${parseFloat(d.protein).toFixed(1)}–≥</td>
                        <td class="${fatClass}">${parseFloat(d.fat).toFixed(1)}–≥</td>
                        <td class="carbs">${parseFloat(d.carbs).toFixed(1)}–≥</td>
                        <td>${parseFloat(d.rating).toFixed(1)}</td>
                        <td><span class="score-badge">${parseFloat(d.score).toFixed(1)}</span></td>
                    </tr>`;
                });
                html += '</table>';
                
                document.getElementById('recommend-results').innerHTML = html;
            } catch(e) {
                document.getElementById('recommend-results').innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞: ${e.message}</div>`;
            }
        }

        // üçΩÔ∏è –î–ù–ï–í–ù–û–ô –†–ê–¶–ò–û–ù v5.2
        async function loadPlan() {
            const params = new URLSearchParams({
                calories: document.getElementById('plan_cal').value,
                protein: document.getElementById('plan_prot').value,
                fat: document.getElementById('plan_fat').value,
                carbs: document.getElementById('plan_carbs').value,
                meals: document.getElementById('plan_meals').value
            });
            
            document.getElementById('plan-results').innerHTML = '<div class="loading">üçΩÔ∏è –°–æ—Å—Ç–∞–≤–ª—è–µ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞—Ü–∏–æ–Ω...</div>';
            
            try {
                const res = await fetch('/plan?' + params);
                const data = await res.json();
                
                let html = `
                    <div class="totals-card">
                        <div style="font-size: 1.6em; font-weight: 800; margin-bottom: 25px;">
                            üìÖ –†–ê–¶–ò–û–ù –ù–ê ${data.targets.meals} –ü–†–ò–ï–ú–û–í –ü–ò–©–ò
                        </div>
                        <div style="font-size: 1.2em; margin-bottom: 20px;">
                            <strong style="color: #d1fae5;">üéØ –¶–ï–õ–¨:</strong> 
                            ${data.targets.calories} –∫–∫–∞–ª | ${data.targets.protein}–≥ –ë | 
                            ${data.targets.fat}–≥ –ñ | ${data.targets.carbs}–≥ –£
                        </div>
                        <div style="font-size: 1.1em;">
                            <strong style="color: #d1fae5;">üìä –§–ê–ö–¢:</strong><br>
                            <span class="nutrient-badge prot-badge">${data.totals.calories.toFixed(0)} –∫–∫–∞–ª (${data.percents.calories}%)</span>
                            <span class="nutrient-badge prot-badge">${data.totals.protein.toFixed(0)}–≥ –ë (${data.percents.protein}%)</span>
                            <span class="nutrient-badge fat-badge">${data.totals.fat.toFixed(0)}–≥ –ñ (${data.percents.fat}%)</span>
                            <span class="nutrient-badge carb-badge">${data.totals.carbs.toFixed(0)}–≥ –£ (${data.percents.carbs}%)</span>
                        </div>
                        <div class="quality-badge">${data.quality}/100</div>
                    </div>
                    
                    <div class="quality-breakdown">
                        <div class="breakdown-item">
                            <div style="font-size: 2em; color: #10b981;">${data.percents.calories}%</div>
                            <div>–ö–∞–ª–æ—Ä–∏–∏</div>
                        </div>
                        <div class="breakdown-item">
                            <div style="font-size: 2em; color: #10b981;">${data.percents.protein}%</div>
                            <div>–ë–µ–ª–æ–∫</div>
                        </div>
                        <div class="breakdown-item">
                            <div style="font-size: 2em; color: #f59e0b;">${data.percents.fat}%</div>
                            <div>–ñ–∏—Ä—ã</div>
                        </div>
                        <div class="breakdown-item">
                            <div style="font-size: 2em; color: #3b82f6;">${data.percents.carbs}%</div>
                            <div>–£–≥–ª–µ–≤–æ–¥—ã</div>
                        </div>
                    </div>
                    
                    <table>
                        <tr>
                            <th style="width: 120px;">–ü—Ä–∏–µ–º –ø–∏—â–∏</th>
                            <th style="width: 45%;">–ë–ª—é–¥–æ</th>
                            <th>–ö–∫–∞–ª</th>
                            <th>–ë/–ñ/–£</th>
                            <th>Score</th>
                        </tr>`;
                
                data.plan.forEach(m => {
                    html += `<tr>
                        <td style="font-size: 1.3em; font-weight: 800; color: #10b981;">${m.meal}</td>
                        <td style="font-weight: 700;">${m.title}</td>
                        <td style="color: #10b981; font-weight: 700;">${m.calories.toFixed(0)}</td>
                        <td style="font-weight: 600;">${m.protein.toFixed(1)}/${m.fat.toFixed(1)}/${m.carbs.toFixed(1)}</td>
                        <td><span class="score-badge">${m.score.toFixed(1)}</span></td>
                    </tr>`;
                });
                html += '</table>';
                
                document.getElementById('plan-results').innerHTML = html;
            } catch(e) {
                document.getElementById('plan-results').innerHTML = `<div class="error">‚ùå ${e.message}</div>`;
            }
        }

        // –ü–†–ï–°–ï–¢–´
        function presetProtein() {
            document.getElementById('min_prot').value = 25;
            document.getElementById('max_fat').value = 10;
            document.getElementById('max_cal').value = 400;
            document.getElementById('search').value = '';
            loadRecommend();
        }

        function presetDiet() {
            document.getElementById('max_cal').value = 350;
            document.getElementById('max_fat').value = 8;
            document.getElementById('min_prot').value = 20;
            document.getElementById('search').value = '';
            loadRecommend();
        }

        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        window.addEventListener('load', () => {
            loadChart(5);
            loadRecommend();
        });
    </script>
</body>
</html>



